FROM node:10-alpine

EXPOSE 3000

ARG NODE_ENV
ARG JWT_SECRET
ARG JWT_EXPIRATION_MINUTES
ARG MONGO_URI
ARG MONGO_URI_TESTS
ARG EMAIL_PORT
ARG EMAIL_USERNAME
ARG EMAIL_PASSWORD
ENV NODE_ENV $NODE_ENV
ENV JWT_SECRET $JWT_SECRET
ENV JWT_EXPIRATION_MINUTES $JWT_EXPIRATION_MINUTES
ENV MONGO_URI $MONGO_URI
ENV MONGO_URI_TESTS $MONGO_URI_TESTS
ENV EMAIL_PORT $EMAIL_PORT
ENV EMAIL_USERNAME $EMAIL_USERNAME
ENV EMAIL_PASSWORD $EMAIL_PASSWORD

RUN mkdir /app
WORKDIR /app
ADD package.json yarn.lock /app/
RUN yarn --pure-lockfile
ADD . /app

CMD ["yarn", "docker:start"]
